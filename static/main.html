<html lang="eu">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- Angular Material style sheet -->
      <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">
      <!-- Bootstrap -->
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
      <link rel="stylesheet" type="text/css" href="dist/css/bootstrap-material-design.css">
      <link rel="stylesheet" type="text/css" href="dist/css/ripples.min.css">
   </head>
   <body ng-app="mainApp" ng-cloak>
      <div ng-cloak>
         <md-tabs md-dynamic-height flex md-border-bottom>
            
            <md-tab label="Главная">
               <md-tab-body>
               </md-tab-body>
            </md-tab>
             
            <md-tab label="Текущие заявки">
               <md-tab-body>
                  <div ng-controller="targetTaskController" ng-cloak>
                     <md-subheader class="md-no-sticky">Список заявок:</md-subheader>
                     <div class="bs-component">
                        <table class="table table-striped table-hover ">
                           <thead>
                              <tr>
                                 <td>Дата подачи</td>
                                 <td>Тема</td>
                                 <td>Дата выполнения</td>
                                 <td>Статус</td>
                                 <td>Приоритет</td>
                                 <td></td>
                              </tr>
                           </thead>
                           <tbody ng-repeat="item in tasks track by $index" >
                              <tr data-toggle="collapse" data-target="#colapsed{{$index}}" class="clickable" >
                                 <td >{{item.datestart}}</td>
                                 <td>{{item.theme}}</td>
                                 <td>{{item.dateend}}</td>
                                 <td>{{item.status}}</td>
                                 <td>{{item.priority}}</td>
                                 <td></td>                 
                              </tr>
                              <tr>
                                 <td colspan="4">
																																				
                                    <div id="colapsed{{$index}}" class="collapse">
																																								{{item.text}}
																																								<br>
																																								  <div layout="row" layout-align="end center">
																																													<md-button >Закрыть заявку</md-button>
																																										</div>
																																					</div>
																																				
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div>
               </md-tab-body>
            </md-tab>
          
            <md-tab label="Создать заявку">
				<md-tab-body>
               <div ng-controller="createTaskController" ng-cloak>
                  <md-subheader class="md-no-sticky">Новая заявка:</md-subheader>
                  <div layout-gt-xs="row">
                     <md-input-container flex-gt-xs>
                        <label>ФИО:</label>
                        <input ng-model="task.username" >
                     </md-input-container>
                     <md-input-container flex-gt-md>
                        <label>Приоритет</label>
                        <md-select ng-model="task.priority">
                           <md-option value="Hight">
                              Высокий
                           </md-option>
                           <md-option value="Middle">
                              Средний
                           </md-option>
                           <md-option value="Low">
                              Низкий
                           </md-option>
                        </md-select>
                     </md-input-container>
                  </div>
                  <md-input-container class="md-block">
                     <label>Тема:</label>
                     <input ng-model="task.theme" md-maxlength="50">
                  </md-input-container>
                  <md-input-container class="md-block">
                     <label>Содержание:</label>
                     <textarea ng-model="task.text" md-maxlength="500" rows="5" md-select-on-focus></textarea>
                  </md-input-container>
                  <div layout="row" layout-align="end center">
                     <md-button ng-click="taxTask($event)">Подать заявку</md-button>
                  </div>
               </div>
				</md-tab-body>
            </md-tab>
        
            <md-tab label="Отчет по заявкам">
               <md-tab-body>
                  <div ng-controller="reportTaskController" ng-cloak>
                     <md-subheader class="md-no-sticky">Заявки:</md-subheader>
                     <md-content class="md-padding">
                        <label flex-gt-sm>Период:</label>
                        <md-datepicker ng-model="user.submissionDate" md-placeholder="Начало"></md-datepicker>
                        <md-datepicker ng-model="user.submissionDate" md-placeholder="Конец"></md-datepicker>
                        <md-button >Сформировать</md-button>
                        <p>Выполненые заявки: 10</p>
                        <br>
                        <div class="bs-component">
                           <p>TODO Table</p>
                           <table class="table table-striped table-hover ">
                              <tr ng-repeat="item in taskCount">
                                 <td>{{item.status}}</td>
                                 <td>{{item.count}}</td>
                              </tr>
                           </table>
                           <br>
                        </div>
                     </md-content>
                  </div>
               </md-tab-body>
            </md-tab>
           
            <md-tab label="Администрирование">
				<md-tab-body>
               <md-content class="md-padding">
                  <h1 class="md-display-2">Параметры:</h1>
                  <p>TEXT HERE</p>
               </md-content>
				</md-tab-body>
            </md-tab>
        
          </md-tabs>
      </div>
      <!--CODE HERE-->
      <!-- Angular Material requires Angular.js Libraries -->
      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"></script>
      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"></script>
      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-messages.min.js"></script>
      <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
         crossorigin="anonymous"></script>
      <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
      <!-- Angular Material Library -->
      <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"></script>
      <!-- Your application bootstrap  -->
      <script type="text/javascript">
         var blank = angular.module('mainApp', ['ngMaterial']);
         
         //TODO noraml entering
         blank.controller('targetTaskController', ["$scope", function($scope){
            $scope.tasks = [{
                            datestart    : "01.01.0001",
                              dateend    : "01.01.0001",
                              status     : "На обработке",
                              theme      : "ЧТо-то там",
                              priority   : "Низкий",
                             text        : "Текст запроса"
                              },
                            {
                              datestart  : "01.01.0001",
                              dateend    : "01.01.0001",
                              status     : "На обработке",
                              theme      : "Еще что-то там",
                              priority   : "Высокий" ,
                              text       : "Текст запроса"
                            }
         
                     ]
         }])

         blank.controller('createTaskController', function($scope, $http, $mdDialog){
				
			 $scope.task = new Task();
			 	
			 	$scope.taxTask = (ev) => {
					//TODO Send to server
					$scope.task = new Task();
					
					$scope.result = new TaskResult(true);
					if ($scope.task.getOccupancy()){
						//TODO take result
						
						$scope.result.ok = true;
						if($scope.result.ok){
							$scope.result.text = "Заявка успешно отправлена"
						}else{
							$scope.result.text = "Произошла ошибка при отправке заявки"
						}
					}else{
						$scope.result.text = "Не все поля заполнены"
					}
					
					
					$mdDialog.show(
						
					  $mdDialog.alert()
						.parent(angular.element(document.querySelector('#popupContainer')))
						.clickOutsideToClose(true)
						.title($scope.result.text)
						.ariaLabel('Alert Dialog Tax')
						.ok('ОК')
						.targetEvent(ev)
						
					)	
					
				}
                 
         })
         
         blank.controller('reportTaskController', ["$scope", function($scope){
            
                 
         }])
         
         class RowTask{
              constructor(datestart,dateend,status, theme, priority, text) {
                  this.datestart     = datestart
                  this.dateend       = dateend
                  this.status        = status
                  this.theme         = theme
                  this.priority      = priority
                  this.text          = text
              }
          }
         
         class Task {
               constructor(username,theme, text, priority) {
                   this.username     = username
                   this.theme        = theme
                   this.text         = text
                   this.priority     = priority
               }
			  
			  getOccupancy() {
				  
				  return this.username != "" && this.theme != "" && this.text != "" && this.priority != ""
  				}
			  
			  
           }
         
		 class TaskResult{
			   constructor(ok, text) {
			  		this.ok = ok;
				   	this.text = text;
			   }
		  }
		  
         class Result {
               constructor(status, count) {
                   this.status       = status
                   this.count        = count
               }
           }
         
          //         blank.controller("createTaskController", ["$scope", function($scope) {
          //
          //         }])
		  
      </script>
   </body>
</html>
<!--
   Copyright 2016 Google Inc. All Rights Reserved.
   Use of this source code is governed by an MIT-style license that can be in foundin the LICENSE file at http://material.angularjs.org/license.
   -->
